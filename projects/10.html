<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ENGR 162 Robot - Gabe Kurfman</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <meta name="version" content="1.0.3">
    <meta name="author" content="Gabriel Kurfman">
    <meta name="description" content="LEGO Robot for class final competition">
    <link rel="icon" type="image/x-icon" href="/media/favicon.ico">
    <link href="https://fonts.googleapis.com/css2?family=Architects+Daughter&amp;display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400&amp;display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300&amp;display=swap" rel="stylesheet">
    <link href="/styles.css" rel="stylesheet">
    <link href="/project-details.css" rel="stylesheet">
</head>
<body>
    <header>
        <h1 class="main-title"><span id="projectTitleMain">ENGR 162 Robot</span></h1>
        <nav class="nav-breadcrumb">
            <a href="/index.html">Home</a>/<a href="/projects.html">Projects</a>/<a href="/projects.html?filter=Class%20Projects" id="categoryLink">Class Projects</a>/<span id="currentProject"> ENGR 162 Robot</span>
        </nav>
    </header>

    <div class="project-details-container">
        <div id="projectContent">
            
            <div class="project-date-box" id="projectDateBox">
                <div class="project-date" id="projectDate">Feb 2023 &mdash; Apr 2023</div>
            </div>
            

            <div class="project-content-wrapper" id="projectContentWrapper">
                
                <div class="gallery-container" id="galleryContainer">
                    <div class="photo-gallery">
                        <div class="gallery-preloader" id="galleryPreloader" style="display: none;">Loading media</div>
                        <div class="gallery-media-wrapper" id="galleryMediaContainer"></div>
                        <button class="gallery-controls prev-btn" onclick="gallery.previous()">&lsaquo;</button>
                        <button class="gallery-controls next-btn" onclick="gallery.next()">&rsaquo;</button>
                    </div>
                    <div class="gallery-indicators" id="galleryIndicators"></div>
                </div>
                

                <div class="project-description">
                    <h3>Project Description</h3>
                    <div class="project-description-content" id="projectDescription">
                        
                            
                                
                                <p>Designed and built a "Global Emergency Autonomous Response System" as part of a four-person engineering team to complete autonomous maze navigation, hazard detection, and cargo delivery tasks. The robot was constructed using LEGO components and a Raspberry Pi board, along with sensors including three ultrasonic sensors, gyroscope, magnetometer, and infrared sensor.</p>
                                
                                <p>The mechanical design featured a differential steering drivetrain with two large motorcycle wheels and custom caster wheels. A 3D-printed treasure chest cargo container with custom release mechanism transported "supplies" and deposited them upon exiting the maze. The software implemented a left-wall-following navigation algorithm with coordinate tracking and mapping capabilities.</p>
                                
                            
                        
                    </div>
                </div>
            </div>

            
            <div class="downloads-section" id="downloadsSection">
                <h3>Files</h3>
                <div class="downloads-grid" id="downloadsGrid">
                    
                    <a href="/media/engr-162-robot/Proj3_Report_Team45.pdf" class="download-item" target="_blank">
                        <div class="download-link">Written Report</div>
                        <div class="download-description">Final report on the project</div>
                    </a>
                    
                    <a href="/media/engr-162-robot/Proj3_Pres_Team_45.pdf" class="download-item" target="_blank">
                        <div class="download-link">Oral Presentation</div>
                        <div class="download-description">Final slideshow on the project</div>
                    </a>
                    
                </div>
            </div>
            
        </div>
    </div>

    <div id="footer-container">
        <footer class="site-footer">
            <p>&copy; 2025 Gabriel Kurfman. Hosted by GitHub Pages.</p>
        </footer>
        <div class="bottom-buttons">
            <a href="mailto:contact@gabekurfman.com" class="bottom-button">Contact Me</a>
            <!-- <button class="bottom-button" onclick="toggleJellyfishMode()">Jellyfish Mode</button> -->
        </div>
    </div>

    <script src="/utils.js"></script>
    <script>
        // Project media data embedded via Jinja
        const projectMedia = [{"src": "/media/engr-162-robot/1.jpg", "type": "image"}, {"src": "/media/engr-162-robot/2.jpg", "type": "image"}, {"src": "/media/engr-162-robot/3.jpg", "type": "image"}, {"src": "/media/engr-162-robot/OrthographicRender.png", "type": "image"}, {"src": "https://youtu.be/zB8ffvr1eyU", "type": "video"}];

        class Gallery {
            constructor() {
                this.currentIndex = 0;
                this.media = [];
                this.autoAdvanceTimer = null;
                this.indicators = [];
                this.mediaContainer = null;
                this.preloadedMedia = new Map();
                this.isPreloading = false;
                this.isTransitioning = false;
            }

            initialize(media) {
                if (!media || media.length === 0) return;

                this.media = media;
                this.currentIndex = 0;
                this.mediaContainer = document.getElementById('galleryMediaContainer');
                this.isTransitioning = false;

                // Show gallery container and preloader
                document.getElementById('galleryContainer').style.display = 'block';
                this.showPreloader();

                this.createIndicators();
                
                // Preload all media first, then show the gallery
                this.preloadAllMedia().then(() => {
                    this.hidePreloader();
                    this.showCurrentMedia();
                    this.startAutoAdvance();
                }).catch((error) => {
                    console.error('Error preloading media:', error);
                    this.hidePreloader();
                    this.showCurrentMedia();
                    this.startAutoAdvance();
                });
            }

            showPreloader() {
                document.getElementById('galleryPreloader').style.display = 'block';
            }

            hidePreloader() {
                document.getElementById('galleryPreloader').style.display = 'none';
            }

            async preloadAllMedia() {
                this.isPreloading = true;
                const preloadPromises = this.media.map((mediaItem, index) => {
                    return this.preloadMediaItem(mediaItem, index);
                });

                try {
                    await Promise.allSettled(preloadPromises);
                } finally {
                    this.isPreloading = false;
                }
            }

            preloadMediaItem(mediaItem, index) {
                return new Promise((resolve, reject) => {
                    if (mediaItem.type === 'video') {
                        if (this.isYouTubeUrl(mediaItem.src)) {
                            this.preloadedMedia.set(index, { type: 'youtube', src: mediaItem.src });
                            resolve();
                        } else {
                            const video = document.createElement('video');
                            video.preload = 'metadata';
                            video.muted = true;
                            
                            const handleLoad = () => {
                                this.preloadedMedia.set(index, { type: 'video', element: video });
                                resolve();
                            };
                            
                            const handleError = (e) => {
                                console.warn(`Failed to preload video ${index}:`, mediaItem.src, e);
                                reject(new Error(`Failed to preload video ${index}`));
                            };
                            
                            video.addEventListener('loadedmetadata', handleLoad, { once: true });
                            video.addEventListener('error', handleError, { once: true });
                            video.src = mediaItem.src;
                        }
                    } else {
                        const img = new Image();
                        
                        const handleLoad = () => {
                            if (img.naturalWidth > 0 && img.naturalHeight > 0) {
                                this.preloadedMedia.set(index, { type: 'image', element: img });
                                resolve();
                            } else {
                                console.warn(`Image loaded but has invalid dimensions ${index}:`, mediaItem.src);
                                reject(new Error(`Invalid image dimensions ${index}`));
                            }
                        };
                        
                        const handleError = (e) => {
                            console.warn(`Failed to preload image ${index}:`, mediaItem.src, e);
                            reject(new Error(`Failed to preload image ${index}`));
                        };
                        
                        img.addEventListener('load', handleLoad, { once: true });
                        img.addEventListener('error', handleError, { once: true });
                        img.src = mediaItem.src;
                    }
                });
            }

            extractYouTubeId(url) {
                const regexPatterns = [
                    /(?:youtube\.com\/watch\?v=)([^&\n?#]+)/,
                    /(?:youtu\.be\/)([^&\n?#]+)/,
                    /(?:youtube\.com\/embed\/)([^&\n?#]+)/,
                    /(?:youtube\.com\/shorts\/)([^&\n?#]+)/,
                    /(?:m\.youtube\.com\/watch\?v=)([^&\n?#]+)/,
                    /youtube\.com\/watch\?.*v=([^&\n?#]+)/
                ];
                
                for (const pattern of regexPatterns) {
                    const match = url.match(pattern);
                    if (match) return match[1];
                }
                return null;
            }

            isYouTubeUrl(url) {
                return /(?:youtube\.com|youtu\.be|m\.youtube\.com)/.test(url);
            }

            createIndicators() {
                const container = document.getElementById('galleryIndicators');
                container.innerHTML = '';
                this.indicators = [];

                this.media.forEach((_, index) => {
                    const indicator = document.createElement('span');
                    indicator.className = 'indicator';
                    indicator.addEventListener('click', () => this.goTo(index));
                    container.appendChild(indicator);
                    this.indicators.push(indicator);
                });
            }

            showCurrentMedia() {
                if (this.isTransitioning) return;
                this.isTransitioning = true;
                
                this.indicators.forEach((indicator, index) => {
                    indicator.classList.toggle('active', index === this.currentIndex);
                });

                const currentMedia = this.media[this.currentIndex];
                const preloadedData = this.preloadedMedia.get(this.currentIndex);
                let newElement;

                if (currentMedia.type === 'video') {
                    this.clearContainer();

                    if (this.isYouTubeUrl(currentMedia.src)) {
                        newElement = this.createYouTubeEmbed(currentMedia.src);
                    } else {
                        if (preloadedData && preloadedData.type === 'video') {
                            newElement = preloadedData.element.cloneNode(true);
                            newElement.className = 'gallery-media is-video loaded';
                            newElement.controls = true;
                            newElement.currentTime = 0;
                        } else {
                            newElement = document.createElement('video');
                            newElement.className = 'gallery-media is-video loaded';
                            newElement.src = currentMedia.src;
                            newElement.controls = true;
                            newElement.preload = 'metadata';
                            newElement.muted = true;
                        }

                        newElement.addEventListener('play', () => this.stopAutoAdvance());
                        newElement.addEventListener('pause', () => this.startAutoAdvance());
                        newElement.addEventListener('loadeddata', () => {
                            newElement.play().catch(error => {
                                console.log('Autoplay prevented:', error);
                            });
                        });
                    }

                    this.mediaContainer.appendChild(newElement);
                    this.endTransition();
                } else {
                    this.crossFadeToImage(currentMedia, preloadedData);
                }
            }

            crossFadeToImage(mediaItem, preloadedData) {
                let newElement;
                
                if (preloadedData && preloadedData.type === 'image') {
                    newElement = preloadedData.element.cloneNode(true);
                    newElement.className = 'gallery-media is-image';
                    newElement.alt = `Project media ${this.currentIndex + 1}`;
                } else {
                    newElement = document.createElement('img');
                    newElement.className = 'gallery-media is-image';
                    newElement.src = mediaItem.src;
                    newElement.alt = `Project media ${this.currentIndex + 1}`;
                }

                newElement.style.opacity = '0';
                this.mediaContainer.appendChild(newElement);

                const performCrossFade = () => {
                    const existingElements = Array.from(this.mediaContainer.querySelectorAll('.gallery-media'))
                        .filter(el => el !== newElement);

                    newElement.style.transition = 'opacity 0.5s ease-in-out';
                    newElement.style.opacity = '1';

                    existingElements.forEach(el => {
                        el.style.transition = 'opacity 0.5s ease-in-out';
                        el.style.opacity = '0';
                    });

                    setTimeout(() => {
                        existingElements.forEach(el => {
                            if (el.parentNode) {
                                el.remove();
                            }
                        });
                        this.endTransition();
                    }, 500);
                };

                if (newElement.complete && newElement.naturalWidth > 0) {
                    setTimeout(performCrossFade, 10);
                } else {
                    newElement.addEventListener('load', performCrossFade, { once: true });
                    newElement.addEventListener('error', () => {
                        console.warn('Failed to load image:', mediaItem.src);
                        this.endTransition();
                    }, { once: true });

                    setTimeout(() => {
                        if (this.isTransitioning) {
                            performCrossFade();
                        }
                    }, 2000);
                }
            }

            clearContainer() {
                this.mediaContainer.innerHTML = '';
            }

            endTransition() {
                this.isTransitioning = false;
            }

            createYouTubeEmbed(url) {
                const videoId = this.extractYouTubeId(url);
                if (!videoId) {
                    console.error('Could not extract YouTube video ID from:', url);
                    return this.createErrorElement('Invalid YouTube URL');
                }

                const iframe = document.createElement('iframe');
                iframe.className = 'gallery-media is-youtube loaded';
                iframe.src = `https://www.youtube.com/embed/${videoId}?autoplay=1&enablejsapi=1&rel=0&modestbranding=1&controls=1&mute=1`;
                iframe.frameBorder = '0';
                iframe.allowFullscreen = true;
                iframe.title = 'YouTube Video';

                iframe.addEventListener('load', () => {
                    this.stopAutoAdvance();
                });

                return iframe;
            }

            createErrorElement(message) {
                const errorDiv = document.createElement('div');
                errorDiv.className = 'gallery-media is-error loaded';
                errorDiv.textContent = message;
                return errorDiv;
            }

            next() {
                if (this.isTransitioning) return;
                this.currentIndex = (this.currentIndex + 1) % this.media.length;
                this.showCurrentMedia();
                this.resetAutoAdvance();
            }

            previous() {
                if (this.isTransitioning) return;
                this.currentIndex = (this.currentIndex - 1 + this.media.length) % this.media.length;
                this.showCurrentMedia();
                this.resetAutoAdvance();
            }

            goTo(index) {
                if (this.isTransitioning) return;
                if (index < 0 || index >= this.media.length) return;
                this.currentIndex = index;
                this.showCurrentMedia();
                this.resetAutoAdvance();
            }

            startAutoAdvance() {
                if (this.media.length <= 1) return;
                this.stopAutoAdvance();
                this.autoAdvanceTimer = setInterval(() => {
                    const currentElement = this.mediaContainer.querySelector('.gallery-media');
                    if (currentElement && currentElement.classList.contains('is-image') && !this.isTransitioning) {
                        this.next();
                    }
                }, 5000);
            }

            stopAutoAdvance() {
                if (this.autoAdvanceTimer) {
                    clearInterval(this.autoAdvanceTimer);
                    this.autoAdvanceTimer = null;
                }
            }

            resetAutoAdvance() {
                this.stopAutoAdvance();
                setTimeout(() => {
                    const currentElement = this.mediaContainer.querySelector('.gallery-media');
                    if (currentElement && currentElement.classList.contains('is-image')) {
                        this.startAutoAdvance();
                    }
                }, 1000);
            }

            destroy() {
                this.stopAutoAdvance();
                this.isTransitioning = false;
                if (this.mediaContainer) {
                    this.mediaContainer.innerHTML = '';
                }
                this.preloadedMedia.clear();
            }
        }

        // Initialize gallery
        const gallery = new Gallery();
        
        // Initialize the page
        function initializePage() {
            // Initialize gallery if media exists
            if (projectMedia && projectMedia.length > 0) {
                gallery.initialize(projectMedia);
            }
        }

        // Keyboard navigation
        document.addEventListener('keydown', function (e) {
            if (gallery.media.length > 0) {
                if (e.key === 'ArrowLeft') {
                    gallery.previous();
                } else if (e.key === 'ArrowRight') {
                    gallery.next();
                }
            }
        });

        // Clean up when page unloads
        window.addEventListener('beforeunload', () => {
            gallery.destroy();
        });

        // Initialize when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializePage);
        } else {
            initializePage();
        }
    </script>
</body>
</html>